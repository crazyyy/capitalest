{"version":3,"sources":["selectivizr.js"],"names":["win","patchStyleSheet","cssText","replace","RE_PSEUDO_ELEMENTS","PLACEHOLDER_STRING","RE_SELECTOR_GROUP","m","prefix","selectorText","selectorGroups","split","c","cs","length","selector","normalizeSelectorWhitespace","SPACE_STRING","patches","RE_SELECTOR_PARSE","match","combinator","pseudo","attribute","index","domPatches","push","substring","patch","patchPseudoClass","patchAttribute","className","join","attr","BROKEN_ATTR_IMPLEMENTATIONS","test","createClassName","applyClass","activateEventName","deactivateEventName","slice","isNegated","bracketIndex","indexOf","charAt","e","root","ieVersion","handler","hash","location","hashID","EMPTY_STRING","id","addEvent","toggleElementClass","RE_INPUT_CHECKABLE_TYPES","type","event","propertyName","checked","RE_INPUT_ELEMENTS","tagName","$disabled","enabledWatchers","disabled","RE_PSEUDO_STRUCTURAL","applyPatches","elms","domSelectorText","RE_LIBRARY_INCOMPATIBLE_PSEUDOS","selectorMethod","ex","log","d","dl","elm","cssClasses","f","fl","hasPatch","toggleClass","RegExp","namespace","patchIE6MultipleClasses","ie6PatchID","RE_PATCH_CLASS_NAME_REPLACE","a","charCodeAt","message","console","trim","text","RE_TIDY_TRIM_WHITESPACE","normalizeWhitespace","RE_TIDY_CONSECUTIVE_WHITESPACE","RE_TIDY_TRAILING_WHITESPACE","RE_TIDY_LEADING_WHITESPACE","on","oldClassName","newClassName","parentNode","classList","re","classExists","eventName","eventHandler","attachEvent","getXHRObject","XMLHttpRequest","ActiveXObject","loadStyleSheet","url","xhr","open","send","status","responseText","resolveUrl","contextUrl","ignoreSameOriginPolicy","getProtocol","getProtocolAndHost","baseUrl","contextUrlPath","lastIndexOf","parseStyleSheet","RE_COMMENT","RE_IMPORT","quoteChar","importUrl","quoteChar2","importUrl2","media","RE_ASSET_URL","isBehavior","assetUrl","getStyleSheets","stylesheet","doc","styleSheets","href","init","setInterval","cl","ContentLoaded","fn","done","top","readyState","detachEvent","call","poll","doScroll","setTimeout","createEventObject","frameElement","ieUserAgent","navigator","userAgent","document","documentElement","compatMode","selectorEngines","NW","MooTools","DOMAssistant","Prototype","YAHOO","Sizzle","jQuery","dojo","baseTags","getElementsByTagName","engine","members","member","context","shift","this"],"mappings":"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","file":"selectivizr.js","sourcesContent":["/*\r\nselectivizr v1.0.3b - (c) Keith Clark, freely distributable under the terms\r\nof the MIT license.\r\n\r\nselectivizr.com\r\n*/\r\n/*\r\n\r\nNotes about this source\r\n-----------------------\r\n\r\n * The #DEBUG_START and #DEBUG_END comments are used to mark blocks of code\r\n   that will be removed prior to building a final release version (using a\r\n   pre-compression script)\r\n\r\n\r\nReferences:\r\n-----------\r\n\r\n * CSS Syntax          : http://www.w3.org/TR/2003/WD-css3-syntax-20030813/#style\r\n * Selectors           : http://www.w3.org/TR/css3-selectors/#selectors\r\n * IE Compatability    : http://msdn.microsoft.com/en-us/library/cc351024(VS.85).aspx\r\n * W3C Selector Tests  : http://www.w3.org/Style/CSS/Test/CSS3/Selectors/current/html/tests/\r\n\r\n*/\r\n\r\n(function(win) {\r\n\r\n  // Determine IE version and stop execution if browser isn't IE. This\r\n  // handles the script being loaded by non IE browsers because the\r\n  // developer didn't use conditional comments.\r\n  var ieUserAgent = navigator.userAgent.match(/MSIE (\\d+)/);\r\n  if (!ieUserAgent) {\r\n    return false;\r\n  }\r\n\r\n  // =========================== Init Objects ============================\r\n\r\n  var doc = document;\r\n  var root = doc.documentElement;\r\n  var xhr = getXHRObject();\r\n  var ieVersion = ieUserAgent[1];\r\n\r\n  // If were not in standards mode, IE is too old / new or we can't create\r\n  // an XMLHttpRequest object then we should get out now.\r\n  if (doc.compatMode != 'CSS1Compat' || ieVersion<6 || ieVersion>8 || !xhr) {\r\n    return;\r\n  }\r\n\r\n\r\n  // ========================= Common Objects ============================\r\n\r\n  // Compatiable selector engines in order of CSS3 support. Note: '*' is\r\n  // a placholder for the object key name. (basically, crude compression)\r\n  var selectorEngines = {\r\n    \"NW\"                : \"*.Dom.select\",\r\n    \"MooTools\"              : \"$$\",\r\n    \"DOMAssistant\"            : \"*.$\",\r\n    \"Prototype\"              : \"$$\",\r\n    \"YAHOO\"                : \"*.util.Selector.query\",\r\n    \"Sizzle\"              : \"*\",\r\n    \"jQuery\"              : \"*\",\r\n    \"dojo\"                : \"*.query\"\r\n  };\r\n\r\n  var selectorMethod;\r\n  var enabledWatchers           = [];     // array of :enabled/:disabled elements to poll\r\n  var domPatches              = [];\r\n  var ie6PatchID               = 0;      // used to solve ie6's multiple class bug\r\n  var patchIE6MultipleClasses        = true;   // if true adds class bloat to ie6\r\n  var namespace               = \"slvzr\";\r\n\r\n  // Stylesheet parsing regexp's\r\n  var RE_COMMENT              = /(\\/\\*[^*]*\\*+([^\\/][^*]*\\*+)*\\/)\\s*?/g;\r\n  var RE_IMPORT              = /@import\\s*(?:(?:(?:url\\(\\s*(['\"]?)(.*)\\1)\\s*\\))|(?:(['\"])(.*)\\3))\\s*([^;]*);/g;\r\n  var RE_ASSET_URL             = /(behavior\\s*?:\\s*)?\\burl\\(\\s*([\"']?)(?!data:)([^\"')]+)\\2\\s*\\)/g;\r\n  var RE_PSEUDO_STRUCTURAL        = /^:(empty|(first|last|only|nth(-last)?)-(child|of-type))$/;\r\n  var RE_PSEUDO_ELEMENTS          = /:(:first-(?:line|letter))/g;\r\n  var RE_SELECTOR_GROUP          = /((?:^|(?:\\s*})+)(?:\\s*@media[^{]+{)?)\\s*([^\\{]*?[\\[:][^{]+)/g;\r\n  var RE_SELECTOR_PARSE          = /([ +~>])|(:[a-z-]+(?:\\(.*?\\)+)?)|(\\[.*?\\])/g;\r\n  var RE_LIBRARY_INCOMPATIBLE_PSEUDOS    = /(:not\\()?:(hover|enabled|disabled|focus|checked|target|active|visited|first-line|first-letter)\\)?/g;\r\n  var RE_PATCH_CLASS_NAME_REPLACE      = /[^\\w-]/g;\r\n\r\n  // HTML UI element regexp's\r\n  var RE_INPUT_ELEMENTS          = /^(INPUT|SELECT|TEXTAREA|BUTTON)$/;\r\n  var RE_INPUT_CHECKABLE_TYPES      = /^(checkbox|radio)$/;\r\n\r\n  // Broken attribute selector implementations (IE7/8 native [^=\"\"], [$=\"\"] and [*=\"\"])\r\n  var BROKEN_ATTR_IMPLEMENTATIONS      = ieVersion>6 ? /[\\$\\^*]=(['\"])\\1/ : null;\r\n\r\n  // Whitespace normalization regexp's\r\n  var RE_TIDY_TRAILING_WHITESPACE      = /([(\\[+~])\\s+/g;\r\n  var RE_TIDY_LEADING_WHITESPACE      = /\\s+([)\\]+~])/g;\r\n  var RE_TIDY_CONSECUTIVE_WHITESPACE    = /\\s+/g;\r\n  var RE_TIDY_TRIM_WHITESPACE        = /^\\s*((?:[\\S\\s]*\\S)?)\\s*$/;\r\n\r\n  // String constants\r\n  var EMPTY_STRING            = \"\";\r\n  var SPACE_STRING            = \" \";\r\n  var PLACEHOLDER_STRING          = \"$1\";\r\n\r\n  // =========================== Patching ================================\r\n\r\n  // --[ patchStyleSheet() ]----------------------------------------------\r\n  // Scans the passed cssText for selectors that require emulation and\r\n  // creates one or more patches for each matched selector.\r\n  function patchStyleSheet( cssText ) {\r\n    return cssText.replace(RE_PSEUDO_ELEMENTS, PLACEHOLDER_STRING).\r\n      replace(RE_SELECTOR_GROUP, function(m, prefix, selectorText) {\r\n          var selectorGroups = selectorText.split(\",\");\r\n          for (var c = 0, cs = selectorGroups.length; c < cs; c++) {\r\n            var selector = normalizeSelectorWhitespace(selectorGroups[c]) + SPACE_STRING;\r\n            var patches = [];\r\n            selectorGroups[c] = selector.replace(RE_SELECTOR_PARSE,\r\n              function(match, combinator, pseudo, attribute, index) {\r\n                if (combinator) {\r\n                  if (patches.length>0) {\r\n                    domPatches.push( { selector: selector.substring(0, index), patches: patches } )\r\n                    patches = [];\r\n                  }\r\n                  return combinator;\r\n                }\r\n                else {\r\n                  var patch = (pseudo) ? patchPseudoClass( pseudo ) : patchAttribute( attribute );\r\n                  if (patch) {\r\n                    patches.push(patch);\r\n                    return \".\" + patch.className;\r\n                  }\r\n                  return match;\r\n                }\r\n              }\r\n            );\r\n          }\r\n          return prefix + selectorGroups.join(\",\");\r\n        });\r\n  };\r\n\r\n  // --[ patchAttribute() ]-----------------------------------------------\r\n  // returns a patch for an attribute selector.\r\n  function patchAttribute( attr ) {\r\n    return (!BROKEN_ATTR_IMPLEMENTATIONS || BROKEN_ATTR_IMPLEMENTATIONS.test(attr)) ?\r\n      { className: createClassName(attr), applyClass: true } : null;\r\n  };\r\n\r\n  // --[ patchPseudoClass() ]---------------------------------------------\r\n  // returns a patch for a pseudo-class\r\n  function patchPseudoClass( pseudo ) {\r\n\r\n    var applyClass = true;\r\n    var className = createClassName(pseudo.slice(1));\r\n    var isNegated = pseudo.substring(0, 5) == \":not(\";\r\n    var activateEventName;\r\n    var deactivateEventName;\r\n\r\n    // if negated, remove :not()\r\n    if (isNegated) {\r\n      pseudo = pseudo.slice(5, -1);\r\n    }\r\n\r\n    // bracket contents are irrelevant - remove them\r\n    var bracketIndex = pseudo.indexOf(\"(\")\r\n    if (bracketIndex > -1) {\r\n      pseudo = pseudo.substring(0, bracketIndex);\r\n    }\r\n\r\n    // check we're still dealing with a pseudo-class\r\n    if (pseudo.charAt(0) == \":\") {\r\n      switch (pseudo.slice(1)) {\r\n\r\n        case \"root\":\r\n          applyClass = function(e) {\r\n            return isNegated ? e != root : e == root;\r\n          }\r\n          break;\r\n\r\n        case \"target\":\r\n          // :target is only supported in IE8\r\n          if (ieVersion == 8) {\r\n            applyClass = function(e) {\r\n              var handler = function() {\r\n                var hash = location.hash;\r\n                var hashID = hash.slice(1);\r\n                return isNegated ? (hash == EMPTY_STRING || e.id != hashID) : (hash != EMPTY_STRING && e.id == hashID);\r\n              };\r\n              addEvent( win, \"hashchange\", function() {\r\n                toggleElementClass(e, className, handler());\r\n              })\r\n              return handler();\r\n            }\r\n            break;\r\n          }\r\n          return false;\r\n\r\n        case \"checked\":\r\n          applyClass = function(e) {\r\n            if (RE_INPUT_CHECKABLE_TYPES.test(e.type)) {\r\n              addEvent( e, \"propertychange\", function() {\r\n                if (event.propertyName == \"checked\") {\r\n                  toggleElementClass( e, className, e.checked !== isNegated );\r\n                }\r\n              })\r\n            }\r\n            return e.checked !== isNegated;\r\n          }\r\n          break;\r\n\r\n        case \"disabled\":\r\n          isNegated = !isNegated;\r\n\r\n        case \"enabled\":\r\n          applyClass = function(e) {\r\n            if (RE_INPUT_ELEMENTS.test(e.tagName)) {\r\n              addEvent( e, \"propertychange\", function() {\r\n                if (event.propertyName == \"$disabled\") {\r\n                  toggleElementClass( e, className, e.$disabled === isNegated );\r\n                }\r\n              });\r\n              enabledWatchers.push(e);\r\n              e.$disabled = e.disabled;\r\n              return e.disabled === isNegated;\r\n            }\r\n            return pseudo == \":enabled\" ? isNegated : !isNegated;\r\n          }\r\n          break;\r\n\r\n        case \"focus\":\r\n          activateEventName = \"focus\";\r\n          deactivateEventName = \"blur\";\r\n\r\n        case \"hover\":\r\n          if (!activateEventName) {\r\n            activateEventName = \"mouseenter\";\r\n            deactivateEventName = \"mouseleave\";\r\n          }\r\n          applyClass = function(e) {\r\n            addEvent( e, isNegated ? deactivateEventName : activateEventName, function() {\r\n              toggleElementClass( e, className, true );\r\n            })\r\n            addEvent( e, isNegated ? activateEventName : deactivateEventName, function() {\r\n              toggleElementClass( e, className, false );\r\n            })\r\n            return isNegated;\r\n          }\r\n          break;\r\n\r\n        // everything else\r\n        default:\r\n          // If we don't support this pseudo-class don't create\r\n          // a patch for it\r\n          if (!RE_PSEUDO_STRUCTURAL.test(pseudo)) {\r\n            return false;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    return { className: className, applyClass: applyClass };\r\n  };\r\n\r\n  // --[ applyPatches() ]-------------------------------------------------\r\n  function applyPatches() {\r\n    var elms, selectorText, patches, domSelectorText;\r\n\r\n    for (var c=0; c<domPatches.length; c++) {\r\n      selectorText = domPatches[c].selector;\r\n      patches = domPatches[c].patches;\r\n\r\n      // Although some selector libraries can find :checked :enabled etc.\r\n      // we need to find all elements that could have that state because\r\n      // it can be changed by the user.\r\n      domSelectorText = selectorText.replace(RE_LIBRARY_INCOMPATIBLE_PSEUDOS, EMPTY_STRING);\r\n\r\n      // If the dom selector equates to an empty string or ends with\r\n      // whitespace then we need to append a universal selector (*) to it.\r\n      if (domSelectorText == EMPTY_STRING || domSelectorText.charAt(domSelectorText.length - 1) == SPACE_STRING) {\r\n        domSelectorText += \"*\";\r\n      }\r\n\r\n      // Ensure we catch errors from the selector library\r\n      try {\r\n        elms = selectorMethod( domSelectorText );\r\n      } catch (ex) {\r\n        // #DEBUG_START\r\n        log( \"Selector '\" + selectorText + \"' threw exception '\" + ex + \"'\" );\r\n        // #DEBUG_END\r\n      }\r\n\r\n\r\n      if (elms) {\r\n        for (var d = 0, dl = elms.length; d < dl; d++) {\r\n          var elm = elms[d];\r\n          var cssClasses = elm.className;\r\n          for (var f = 0, fl = patches.length; f < fl; f++) {\r\n            var patch = patches[f];\r\n            if (!hasPatch(elm, patch)) {\r\n              if (patch.applyClass && (patch.applyClass === true || patch.applyClass(elm) === true)) {\r\n                cssClasses = toggleClass(cssClasses, patch.className, true );\r\n              }\r\n            }\r\n          }\r\n          elm.className = cssClasses;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // --[ hasPatch() ]-----------------------------------------------------\r\n  // checks for the exsistence of a patch on an element\r\n  function hasPatch( elm, patch ) {\r\n    return new RegExp(\"(^|\\\\s)\" + patch.className + \"(\\\\s|$)\").test(elm.className);\r\n  };\r\n\r\n\r\n  // =========================== Utility =================================\r\n\r\n  function createClassName( className ) {\r\n    return namespace + \"-\" + ((ieVersion == 6 && patchIE6MultipleClasses) ?\r\n      ie6PatchID++\r\n    :\r\n      className.replace(RE_PATCH_CLASS_NAME_REPLACE, function(a) { return a.charCodeAt(0) }));\r\n  };\r\n\r\n  // --[ log() ]----------------------------------------------------------\r\n  // #DEBUG_START\r\n  function log( message ) {\r\n    if (win.console) {\r\n      win.console.log(message);\r\n    }\r\n  };\r\n  // #DEBUG_END\r\n\r\n  // --[ trim() ]---------------------------------------------------------\r\n  // removes leading, trailing whitespace from a string\r\n  function trim( text ) {\r\n    return text.replace(RE_TIDY_TRIM_WHITESPACE, PLACEHOLDER_STRING);\r\n  };\r\n\r\n  // --[ normalizeWhitespace() ]------------------------------------------\r\n  // removes leading, trailing and consecutive whitespace from a string\r\n  function normalizeWhitespace( text ) {\r\n    return trim(text).replace(RE_TIDY_CONSECUTIVE_WHITESPACE, SPACE_STRING);\r\n  };\r\n\r\n  // --[ normalizeSelectorWhitespace() ]----------------------------------\r\n  // tidies whitespace around selector brackets and combinators\r\n  function normalizeSelectorWhitespace( selectorText ) {\r\n    return normalizeWhitespace(selectorText.\r\n      replace(RE_TIDY_TRAILING_WHITESPACE, PLACEHOLDER_STRING).\r\n      replace(RE_TIDY_LEADING_WHITESPACE, PLACEHOLDER_STRING)\r\n    );\r\n  };\r\n\r\n  // --[ toggleElementClass() ]-------------------------------------------\r\n  // toggles a single className on an element\r\n  function toggleElementClass( elm, className, on ) {\r\n    var oldClassName = elm.className;\r\n    var newClassName = toggleClass(oldClassName, className, on);\r\n    if (newClassName != oldClassName) {\r\n      elm.className = newClassName;\r\n      elm.parentNode.className += EMPTY_STRING;\r\n    }\r\n  };\r\n\r\n  // --[ toggleClass() ]--------------------------------------------------\r\n  // adds / removes a className from a string of classNames. Used to\r\n  // manage multiple class changes without forcing a DOM redraw\r\n  function toggleClass( classList, className, on ) {\r\n    var re = RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\r\n    var classExists = re.test(classList);\r\n    if (on) {\r\n      return classExists ? classList : classList + SPACE_STRING + className;\r\n    } else {\r\n      return classExists ? trim(classList.replace(re, PLACEHOLDER_STRING)) : classList;\r\n    }\r\n  };\r\n\r\n  // --[ addEvent() ]-----------------------------------------------------\r\n  function addEvent(elm, eventName, eventHandler) {\r\n    elm.attachEvent(\"on\" + eventName, eventHandler);\r\n  };\r\n\r\n  // --[ getXHRObject() ]-------------------------------------------------\r\n  function getXHRObject() {\r\n    if (win.XMLHttpRequest) {\r\n      return new XMLHttpRequest;\r\n    }\r\n    try  {\r\n      return new ActiveXObject('Microsoft.XMLHTTP');\r\n    } catch(e) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // --[ loadStyleSheet() ]-----------------------------------------------\r\n  function loadStyleSheet( url ) {\r\n    xhr.open(\"GET\", url, false);\r\n    xhr.send();\r\n    return (xhr.status==200) ? xhr.responseText : EMPTY_STRING;\r\n  };\r\n\r\n  // --[ resolveUrl() ]---------------------------------------------------\r\n  // Converts a URL fragment to a fully qualified URL using the specified\r\n  // context URL. Returns null if same-origin policy is broken\r\n  function resolveUrl( url, contextUrl, ignoreSameOriginPolicy ) {\r\n\r\n    function getProtocol( url ) {\r\n      return url.substring(0, url.indexOf(\"//\"));\r\n    };\r\n\r\n    function getProtocolAndHost( url ) {\r\n      return url.substring(0, url.indexOf(\"/\", 8));\r\n    };\r\n\r\n    if (!contextUrl) {\r\n      contextUrl = baseUrl;\r\n    }\r\n\r\n    // protocol-relative path\r\n    if (url.substring(0,2)==\"//\") {\r\n      url = getProtocol(contextUrl) + url;\r\n    }\r\n\r\n    // absolute path\r\n    if (/^https?:\\/\\//i.test(url)) {\r\n      return !ignoreSameOriginPolicy && getProtocolAndHost(contextUrl) != getProtocolAndHost(url) ? null : url ;\r\n    }\r\n\r\n    // root-relative path\r\n    if (url.charAt(0)==\"/\")  {\r\n      return getProtocolAndHost(contextUrl) + url;\r\n    }\r\n\r\n    // relative path\r\n    var contextUrlPath = contextUrl.split(/[?#]/)[0]; // ignore query string in the contextUrl\r\n    if (url.charAt(0) != \"?\" && contextUrlPath.charAt(contextUrlPath.length - 1) != \"/\") {\r\n      contextUrlPath = contextUrlPath.substring(0, contextUrlPath.lastIndexOf(\"/\") + 1);\r\n    }\r\n\r\n    return contextUrlPath + url;\r\n  };\r\n\r\n  // --[ parseStyleSheet() ]----------------------------------------------\r\n  // Downloads the stylesheet specified by the URL, removes it's comments\r\n  // and recursivly replaces @import rules with their contents, ultimately\r\n  // returning the full cssText.\r\n  function parseStyleSheet( url ) {\r\n    if (url) {\r\n      return loadStyleSheet(url).replace(RE_COMMENT, EMPTY_STRING).\r\n      replace(RE_IMPORT, function( match, quoteChar, importUrl, quoteChar2, importUrl2, media ) {\r\n        var cssText = parseStyleSheet(resolveUrl(importUrl || importUrl2, url));\r\n        return (media) ? \"@media \" + media + \" {\" + cssText + \"}\" : cssText;\r\n      }).\r\n      replace(RE_ASSET_URL, function( match, isBehavior, quoteChar, assetUrl ) {\r\n        quoteChar = quoteChar || EMPTY_STRING;\r\n        return isBehavior ? match : \" url(\" + quoteChar + resolveUrl(assetUrl, url, true) + quoteChar + \") \";\r\n      });\r\n    }\r\n    return EMPTY_STRING;\r\n  };\r\n\r\n  // --[ getStyleSheets() ]-----------------------------------------------\r\n  function getStyleSheets() {\r\n    var url, stylesheet;\r\n    for (var c = 0; c < doc.styleSheets.length; c++) {\r\n      stylesheet = doc.styleSheets[c];\r\n      if (stylesheet.href != EMPTY_STRING) {\r\n        url = resolveUrl(stylesheet.href);\r\n        if (url) {\r\n          stylesheet.cssText = stylesheet[\"rawCssText\"] = patchStyleSheet( parseStyleSheet( url ) );\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // --[ init() ]---------------------------------------------------------\r\n  function init() {\r\n    applyPatches();\r\n\r\n    // :enabled & :disabled polling script (since we can't hook\r\n    // onpropertychange event when an element is disabled)\r\n    if (enabledWatchers.length > 0) {\r\n      setInterval( function() {\r\n        for (var c = 0, cl = enabledWatchers.length; c < cl; c++) {\r\n          var e = enabledWatchers[c];\r\n          if (e.disabled !== e.$disabled) {\r\n            if (e.disabled) {\r\n              e.disabled = false;\r\n              e.$disabled = true;\r\n              e.disabled = true;\r\n            }\r\n            else {\r\n              e.$disabled = e.disabled;\r\n            }\r\n          }\r\n        }\r\n      }, 250)\r\n    }\r\n  };\r\n\r\n  // Determine the baseUrl and download the stylesheets\r\n  var baseTags = doc.getElementsByTagName(\"BASE\");\r\n  var baseUrl = (baseTags.length > 0) ? baseTags[0].href : doc.location.href;\r\n  getStyleSheets();\r\n\r\n  // Bind selectivizr to the ContentLoaded event.\r\n  ContentLoaded(win, function() {\r\n    // Determine the \"best fit\" selector engine\r\n    for (var engine in selectorEngines) {\r\n      var members, member, context = win;\r\n      if (win[engine]) {\r\n        members = selectorEngines[engine].replace(\"*\", engine).split(\".\");\r\n        while ((member = members.shift()) && (context = context[member])) {}\r\n        if (typeof context == \"function\") {\r\n          selectorMethod = context;\r\n          init();\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n\r\n\r\n  /*!\r\n   * ContentLoaded.js by Diego Perini, modified for IE<9 only (to save space)\r\n   *\r\n   * Author: Diego Perini (diego.perini at gmail.com)\r\n   * Summary: cross-browser wrapper for DOMContentLoaded\r\n   * Updated: 20101020\r\n   * License: MIT\r\n   * Version: 1.2\r\n   *\r\n   * URL:\r\n   * http://javascript.nwbox.com/ContentLoaded/\r\n   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE\r\n   *\r\n   */\r\n\r\n  // @w window reference\r\n  // @f function reference\r\n  function ContentLoaded(win, fn) {\r\n\r\n    var done = false, top = true,\r\n    init = function(e) {\r\n      if (e.type == \"readystatechange\" && doc.readyState != \"complete\") return;\r\n      (e.type == \"load\" ? win : doc).detachEvent(\"on\" + e.type, init, false);\r\n      if (!done && (done = true)) fn.call(win, e.type || e);\r\n    },\r\n    poll = function() {\r\n      try { root.doScroll(\"left\"); } catch(e) { setTimeout(poll, 50); return; }\r\n      init('poll');\r\n    };\r\n\r\n    if (doc.readyState == \"complete\") fn.call(win, EMPTY_STRING);\r\n    else {\r\n      if (doc.createEventObject && root.doScroll) {\r\n        try { top = !win.frameElement; } catch(e) { }\r\n        if (top) poll();\r\n      }\r\n      addEvent(doc,\"readystatechange\", init);\r\n      addEvent(win,\"load\", init);\r\n    }\r\n  };\r\n})(this);\r\n"],"sourceRoot":"/source/"}